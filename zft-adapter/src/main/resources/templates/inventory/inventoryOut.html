<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <div th:replace="~{common/common::cjbar}"/>
    <title>库存-盘点</title>
</head>
<body style="background-color: rgb(225,228,232);">
<div th:replace="~{common/common::headbar}"/>
<div class="inventory">
    <div class="left">
        <div th:replace="~{common/common::inventoryMeau}"/>
    </div>
    <div class="right">
        <div class="top">
            <form id="form1" th:action="@{/inventory/toInventoryOutByQuery}" method="post">
                <div class="form-group" style="float: left;width: 150px;margin-right: 15px;">
                    <select class="form-control" name="inventory_out_status">
                        <option value="">全部状态</option>
                        <option value="待出库">待出库</option>
                        <option value="已出库">已出库</option>
                    </select>
                </div>
                <div class="form-group" style="float: left;width: 120px;margin-right: 15px;">
                    <select class="form-control" name="inventory_out_date_status">
                        <option value="1" selected>创建日期</option>
                        <option value="2">出库日期</option>
                    </select>
                </div>
                <div style="float: left;margin-right: 15px;">
                    <div class="layui-inline">
                        <div class="layui-inline" id="test6">
                            <div class="layui-input-inline float-left" style="width: 100px;">
                                <input type="text" name="inventory_out_begin_time" autocomplete="off" id="test-startDate-1" class="layui-input" style="border: 1px rgb(206,212,218) solid" readonly placeholder="开始日期">
                            </div>
                            <div class="layui-form-mid float-left" style="margin: 0 auto;">-</div>
                            <div class="layui-input-inline float-left" style="width: 100px;">
                                <input type="text" name="inventory_out_end_time" autocomplete="off" id="test-endDate-1" class="layui-input" style="border: 1px rgb(206,212,218) solid" readonly placeholder="结束日期">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="float: left;width: 140px;margin-right: 15px;">
                    <select class="form-control" name="inventory_out_category">
                        <option value="">全部类型</option>
                        <option value="领料出库">领料出库</option>
                        <option value="报损出库">报损出库</option>
                    </select>
                </div>
                <div class="form-group" style="float: left;width: 140px;margin-right: 15px;">
                    <select class="form-control" id="operator" name="inventory_out_operator_id">
                        <option value="">全部出库人</option>
                    </select>
                </div>
                <div style="float: left;">
                    <button type="submit" class="btn btn-outline-primary">查询</button>
                </div>
            </form>
            <div style="float: right;margin-left: 15px;">
                <button type="button" class="btn btn-outline-primary">导出</button>
            </div>
            <div style="float: right;">
                <button type="button" class="btn btn-primary" id="add">新增出库</button>
            </div>
        </div>
        <div class="info" id="outInfoList" th:fragment="outInfoList">
            <table class="table table-striped" style="font-size: 15px;">
                <thead>
                <tr>
                    <td scope="col" width="15%">出库单号</td>
                    <td scope="col" width="5%">状态</td>
                    <td scope="col" width="15%">出库类型</td>
                    <td scope="col" width="5%">品种</td>
                    <td scope="col" width="10%">金额(元)</td>
                    <td scope="col" width="10%">出库人</td>
                    <td scope="col" width="15%">创建日期</td>
                    <td scope="col" width="15%">出库日期</td>
                    <td scope="col" width="10%">操作</td>
                </tr>
                </thead>
                <tbody>
                <tr th:each="inventoryOut:${infoOutDTOList}">
                    <td th:text="${inventoryOut.getInventory_out_id()}"></td>
                    <td th:text="${inventoryOut.getInventory_out_status()}"></td>
                    <td th:text="${inventoryOut.getInventory_out_category()}"></td>
                    <td th:text="${inventoryOut.getInventory_out_variety()}"></td>
                    <td th:text="${inventoryOut.getInventory_out_money()}"></td>
                    <td th:text="${inventoryOut.getInventory_out_operator()}"></td>
                    <td th:text="${inventoryOut.getInventory_out_create_time()}"></td>
                    <td th:text="${inventoryOut.getInventory_out_time()}"></td>
                    <td>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-xs" style="margin-right: 10px;" th:onclick="|detail('${inventoryOut.getInventory_out_id()}')|">查看</button>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-xs">撤回</button>
                    </td>
                </tr>
                </tbody>
            </table>
            <p th:if="${infoOutDTOList.size() == 0}" class="no-data">暂无数据</p>
        </div>
        <div class="bottom">
            <div class="float-left">
                <nav aria-label="Page navigation example">
                    <ul class="pagination">
                        <li class="page-item"><a class="page-link" href="#">上一页</a></li>
                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">...</a></li>
                        <li class="page-item"><a class="page-link" href="#">65</a></li>
                        <li class="page-item"><a class="page-link" href="#">66</a></li>
                        <li class="page-item"><a class="page-link" href="#">下一页</a></li>
                    </ul>
                </nav>
            </div>
            <div class="float-right">
                <p>共4条出库单，金额100.00元</p>
            </div>
        </div>
    </div>
</div>
<div class="inventory-add" id="inventory-add">
    <div class="inventory-pop">
        <div class="top">
            <p></p>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-lg svg-text float-right" id="addClose" viewBox="0 0 16 16">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
        </div>
        <div class="info">
            <div class="info1">
                <p>出库人: 姜昊波</p>
                <p><span style="color: red">*</span> 出库类型</p>
                <div class="form-group" style="float: left;width: 200px;margin-right: 30px;">
                    <select class="form-control" name="">
                        <option value="">领料出库</option>
                        <option value="">报损出库</option>
                    </select>
                </div>
                <p>备注</p>
                <div class="form-group" style="float: left;width: 200px;margin-right: 30px;">
                    <input type="text" class="form-control" name="">
                </div>
            </div>
            <hr>
            <div class="info2">
                <div class="head">
                    <div class="input-group mb-3 float-left" style="width: 500px;">
                        <div class="input-group-prepend">
                            <button type="button" class="btn btn-info" disabled="disabled">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-capsule" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1.828 8.9 8.9 1.827a4 4 0 1 1 5.657 5.657l-7.07 7.071A4 4 0 1 1 1.827 8.9Zm9.128.771 2.893-2.893a3 3 0 1 0-4.243-4.242L6.713 5.429l4.243 4.242Z"/>
                                </svg>
                            </button>
                        </div>
                        <input type="text" class="form-control" placeholder="请输入 药品名/国家码 搜索药品" aria-label="Example text with button addon" aria-describedby="button-addon1">
                    </div>
                    <div class="float-right">
                        <p>品种：0 金额：0.00元</p>
                    </div>
                </div>
                <div class="table1">
                    <table class="table table-striped" style="font-size: 16px;">
                        <thead>
                        <tr>
                            <td scope="col" width="16%">药品名</td>
                            <td scope="col" width="10%">国家码</td>
                            <td scope="col" width="15%">厂家</td>
                            <td scope="col" width="10%">批次号</td>
                            <td scope="col" width="10%">效期</td>
                            <td scope="col" width="10%">当前库存</td>
                            <td scope="col" width="10%"><span style="color: red">*</span> 出库数量</td>
                            <td scope="col" width="7%">售价(元)</td>
                            <td scope="col" width="7%">金额(元)</td>
                            <td scope="col" width="5%"></td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>感冒灵颗粒</td>
                            <td>H524234332</td>
                            <td>四川大吉医药集团</td>
                            <td>20230302001</td>
                            <td>2023年1月5日</td>
                            <td>1000盒</td>
                            <td>300盒</td>
                            <td>25.00</td>
                            <td>7500.00</td>
                            <td>
                                <div class="td-hover">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg svg-text" viewBox="0 0 16 16">
                                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                    </svg>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>感冒灵颗粒</td>
                            <td>H524234332</td>
                            <td>四川大吉医药集团</td>
                            <td>20230302001</td>
                            <td>2023年1月5日</td>
                            <td>1000盒</td>
                            <td>300盒</td>
                            <td>25.00</td>
                            <td>7500.00</td>
                            <td>
                                <div class="td-hover">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg svg-text" viewBox="0 0 16 16">
                                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                    </svg>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="save">
                <div style="float: right;">
                    <button type="button" class="btn btn-primary">保存出库</button>
                </div>
                <div style="float: right;margin-right: 15px;">
                    <button type="button" class="btn btn-primary">等待出库</button>
                </div>
                <div style="float: right;margin-right: 15px;">
                    <button type="button" class="btn btn-outline-primary" id="addClose2">取消</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="inventory-detailed" id="inventory-detailed">
    <div class="inventory-pop" th:fragment="inventoryOutInfo" id="inventoryOutInfo">
        <div class="top">
            <p th:text="'出库单'+${inventoryOutInfo.getInventory_out_id()}+'详情'"></p>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-lg svg-text float-right"  onclick="close3()" viewBox="0 0 16 16">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
        </div>
        <div class="info">
            <div class="info1">
                <p th:text="'出库人: '+${inventoryOutInfo.getInventory_out_operator()}"></p>
                <p th:text="'出库类型: '+${inventoryOutInfo.getInventory_out_category()}"></p>
                <p th:text="'备注: '+${inventoryOutInfo.getInventory_out_remarks()}"></p>
                <div class="float-right">
                    <p th:text="'品种: '+${inventoryOutInfo.getInventory_out_variety()}+' 金额: '+${inventoryOutInfo.getInventory_out_money()}+' 元'"></p>
                </div>
            </div>
            <div class="info2">
                <div class="table2">
                    <table class="table table-striped" style="font-size: 16px;">
                        <thead>
                        <tr>
                            <td scope="col" width="10%">商品ID</td>
                            <td scope="col" width="17%">商品名</td>
                            <td scope="col" width="10%">国家编码</td>
                            <td scope="col" width="13%">规格</td>
                            <td scope="col" width="20%">售价</td>
                            <td scope="col" width="20%">出库数量</td>
                            <td scope="col" width="10%">出库金额(元)</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="outDetail:${inventoryOutInfo.getInventory_out_detail_list()}">
                            <td th:text="${outDetail.getInventory_out_commodity_id()}"></td>
                            <td th:text="${outDetail.getInventory_out_commodity_name()}"></td>
                            <td th:text="${outDetail.getInventory_out_country_code()}"></td>
                            <td th:text="${outDetail.getInventory_out_commodity_specification()}"></td>
                            <td th:if="${outDetail.getInventory_out_split_sale_status() == 1}" th:text="${outDetail.getInventory_out_commodity_large_sale_price()}+'元/'+${outDetail.getInventory_out_large_unit()}+','+${outDetail.getInventory_out_commodity_small_sale_price()}+'元/'+${outDetail.getInventory_out_small_unit()}"></td>
                            <td th:if="${outDetail.getInventory_out_split_sale_status() == 1}" th:text="${outDetail.getInventory_out_large_num()}+${outDetail.getInventory_out_large_unit()}+${outDetail.getInventory_out_small_num()}+${outDetail.getInventory_out_small_unit()}"></td>
                            <td th:if="${outDetail.getInventory_out_split_sale_status() == 1}" th:text="${outDetail.getInventory_out_large_num()*outDetail.getInventory_out_commodity_large_sale_price()+outDetail.getInventory_out_small_num()*outDetail.getInventory_out_commodity_small_sale_price()}"></td>
                            <td th:if="${outDetail.getInventory_out_split_sale_status() == 0}" th:text="${outDetail.getInventory_out_commodity_large_sale_price()}+'元/'+${outDetail.getInventory_out_large_unit()}"></td>
                            <td th:if="${outDetail.getInventory_out_split_sale_status() == 0}" th:text="${outDetail.getInventory_out_large_num()}+${outDetail.getInventory_out_large_unit()}"></td>
                            <td th:if="${outDetail.getInventory_out_split_sale_status() == 0}" th:text="${outDetail.getInventory_out_large_num()*outDetail.getInventory_out_commodity_large_sale_price()}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="shadow" id="shadow">

</div>
<script>
    layui.use('laydate', function(){
        var laydate = layui.laydate;

        //日期范围
        laydate.render({
            elem: '#test6'
            //设置开始日期、日期日期的 input 选择器
            //数组格式为 2.6.6 开始新增，之前版本直接配置 true 或任意分割字符即可
            ,range: ['#test-startDate-1', '#test-endDate-1']
        });
    });
    const btn1 = document.getElementById("add");
    const shadow = document.getElementById("shadow");
    const add = document.getElementById("inventory-add");
    const close1 = document.getElementById("addClose");
    const close2 = document.getElementById("addClose2");
    const detailed = document.getElementById("inventory-detailed");
    const select = document.getElementById("select1");

    // 打开新增弹窗
    btn1.onclick = function () {
        shadow.style.display = "block";
        add.style.display = "block";
    };

    // 关闭新增弹窗
    close1.onclick = function () {
        shadow.style.display = "none";
        add.style.display = "none";
    };

    // 关闭新增弹窗
    close2.onclick = function () {
        shadow.style.display = "none";
        add.style.display = "none";
    };

    // 打开详情弹窗
    select.onclick = function () {
        shadow.style.display = "block";
        detailed.style.display = "block";
    };

    // 关闭详情弹窗
    function close3() {
        shadow.style.display = "none";
        detailed.style.display = "none";
    };

    /**
     * 页面初始加载
     * @type {HTMLElement}
     */
    $(document).ready(function() {
        // 获取入库人列表
        $.ajax({
            url: '/account/getAccountList',
            type: 'GET',
            contentType: false,
            processData: false,
            success: function (response) {
                response.forEach((item)=>{
                    //先创建好select里面的option元素
                    const option = document.createElement("option");
                    //转换DOM对象为JQ对象,好用JQ里面提供的方法 给option的value赋值
                    $(option).val(item.account_id);
                    //给option的text赋值,这就是你点开下拉框能够看到的东西
                    $(option).text(item.account_name);
                    //获取select 下拉框对象,并将option添加进select
                    $('#operator').append(option);
                });
            },
            error:function (response) {
                layer.msg('请求失败，请刷新重试');
            }
        })
    });

    /**
     * 刷新出库单一览页面信息
     */
    const form1 = document.getElementById("form1");
    form1.addEventListener('submit',function (event) {
        // 阻止表单默认提交行为
        event.preventDefault();
        // 创建FormData对象
        const formData1 = new FormData(form1);
        $.ajax({
            url: '/inventory/toInventoryOutByQuery',
            type: 'POST',
            data: formData1,
            contentType: false,
            processData: false,
            success: function (data) {
                $("#outInfoList").html(data);
            },
            error:function (data) {
                layer.msg('请求失败，请刷新重试');
            }
        })
    });

    /**
     * 查看入库单
     * @param id
     */
    function detail(id) {
        $.ajax({
            url: '/inventory/selectOutDetailById?id='+id,
            type: 'GET',
            contentType: false,
            processData: false,
            success: function (response) {
                $("#inventoryOutInfo").html(response);
                // 打开弹窗
                shadow.style.display = "block";
                detailed.style.display = "block";
            },
            error:function (response) {
                layer.msg('请求失败，请刷新重试');
            }
        })
    }
</script>
</body>
</html>

